function initMap(){var e={lat:60.128,lng:18.643};map=new google.maps.Map(document.getElementById("map"),{zoom:2,center:e})}function getMyLocation(e,t){navigator.geolocation.getCurrentPosition(function(n){var r={lat:n.coords.latitude,lng:n.coords.longitude};e.setCenter(r),e.setZoom(10),getCity(t,r)})}function getCity(e,t){var n="";e.geocode({location:t},function(e,t){if("OK"===t)for(var r=0;r<e.length;r++)for(var o=0;o<e[r].types.length;o++)"postal_town"===e[r].types[o]&&loadStoreSearchData(n=e[r].address_components[0].short_name);else alert(t)})}function geocodeAddress(e,t,n,r){var n=n;e.geocode({address:n},function(e,o){if("OK"===o)for(var a=0;a<e.length;a++){t.setCenter(e[a].geometry.location),t.setZoom(12);var i=new google.maps.Marker({map:t,position:e[a].geometry.location,url:r,title:n});google.maps.event.addListener(i,"click",function(){window.location.href="store.html?id="+i.url})}else alert("Something went wrong when geocoding "+o)})}function getStoreID(){var e=location.href;return e.substring(e.indexOf("?id=")+4)}function loadStoreAddress(){$.ajax({url:"https://cors-anywhere.herokuapp.com/https://www.systembolaget.se/api/assortment/stores/xml",success:function(e){for(var t=getStoreID(),n=e.getElementsByTagName("ButikOmbud"),r=0;r<n.length;r++)if(n[r].childNodes[1].textContent===t){var o=n[r].childNodes[6].textContent.toLowerCase();o=o.charAt(0).toUpperCase()+o.slice(1),document.getElementById("address").innerHTML+=n[r].childNodes[3].textContent+" ",document.getElementById("address").innerHTML+=n[r].childNodes[5].textContent+" ",document.getElementById("address").innerHTML+=o}},datatype:"xml",error:function(){alert("Error: Something went wrong with loading stores: "+status)}})}function buildSearchResultTable(e,t,n){for(var r={name:"Namn",group:"Sort",price:"Pris",drinkSugestion:"Drink förslag"},o=Mustache.render("<tr><th>{{name}}</th><th>{{group}}</th><th>{{price}}</th></tr>",r),a=0;a<t;a++){var i={Name:e[a].childNodes[3].textContent+" "+e[a].childNodes[4].textContent,Varugrupp:e[a].childNodes[10].textContent,Prisinklmoms:e[a].childNodes[5].textContent};"Varugrupp"!=e[a].childNodes[10].nodeName&&(i.Varugrupp=e[a].childNodes[11].textContent),o+=Mustache.render("<tr><td>{{{Name}}}</td><td>{{{Varugrupp}}}</td><td>{{{Prisinklmoms}}}</td></tr>",i)}$("#searchResult").html(o),getDrinkSugestions(n)}function getDrinkSugestions(e){var t=getDrinks(e,3);document.getElementById("drinkSugestions").innerHTML="Drink förslag för "+e+": ";for(var n=0;n<t.drinks.length;n++){var r="drink.html?i="+t.drinks[n].idDrink,o=document.createElement("A"),a=document.createTextNode(t.drinks[n].strDrink+", ");o.appendChild(a),o.setAttribute("href",r),document.getElementById("drinkSugestions").appendChild(o)}}function getDrinks(e,t){var n,r="http://www.thecocktaildb.com/api/json/v1/1/filter.php?i="+e;return $.ajax({url:r,async:!1,success:function(e){n='{"drinks":[';for(var r=".",o=0;o<t;o++){do{var a=Math.floor(Math.random()*e.drinks.length)}while(r.indexOf("."+a+".")>0&&"."!==r);r+=a+".",n+=JSON.stringify(e.drinks[a])}return n+="]}",n=replaceAll(n,"}{","},{")},error:function(e,t,n){alert("något gick fel med API-anslutningen")}}),JSON.parse(n)}function replaceAll(e,t,n){return e.replace(new RegExp(t,"g"),n)}function placeStores(e,t,n){for(var r=0;r<e.length;r++){var o=t.toLowerCase();o=o.charAt(0).toUpperCase()+o.slice(1),geocodeAddress(geocoder,map,e[r]+" "+o+" Sverige",n[r])}}function loadStoreSearchData(e){$.ajax({url:"https://cors-anywhere.herokuapp.com/https://www.systembolaget.se/api/assortment/stores/xml",success:function(t){findStore(e,t)},datatype:"xml",error:function(){alert("Error: Something went wrong with loding stores ")}})}function findStore(e,t){for(var n=[],r=[],o=0;o<t.getElementsByTagName("ButikOmbud").length;o++)t.getElementsByTagName("ButikOmbud")[o].childNodes[6].textContent===e.toUpperCase()&&"Ombud"!==t.getElementsByTagName("ButikOmbud")[o].childNodes[0].textContent&&(n.push(t.getElementsByTagName("ButikOmbud")[o].childNodes[3].textContent),r.push(t.getElementsByTagName("ButikOmbud")[o].childNodes[1].textContent));placeStores(n,e.toUpperCase(),r)}function loadStoreInventoryData(e,t){$.ajax({url:"https://cors-anywhere.herokuapp.com/https://www.systembolaget.se/api/assortment/stock/xml",success:function(n){getStoreIventory(e,t,n)},datatype:"xml",error:function(){alert("Error: Something went wrong")}})}function getStoreIventory(e,t,n){for(var r=[],o=0;o<n.getElementsByTagName("Butik").length;o++)if(n.getElementsByTagName("Butik")[o].getAttribute("ButikNr")===t){for(var a=0;a<n.getElementsByTagName("Butik")[o].childNodes.length;a++)r.push(n.getElementsByTagName("Butik")[o].childNodes[a]);o=n.getElementsByTagName("Butik").length}loadArtikelInfoDataForStore(r,e)}function loadArtikelInfoDataForStore(e,t){$.ajax({url:"https://cors-anywhere.herokuapp.com/https://www.systembolaget.se/api/assortment/products/xml",success:function(n){getArtikelInfoForStore(e,n,t)},datatype:"xml",error:function(){alert("Error: Something went wrong")}})}function getArtikelInfoForStore(e,t,n){for(var r=[],o=0;o<e.length;o++)for(var a=0;a<t.getElementsByTagName("artikel").length;a++)t.getElementsByTagName("artikel")[a].childNodes[0].textContent==e[o].textContent&&(t.getElementsByTagName("artikel")[a].childNodes[3].textContent.toLowerCase().includes(n)||t.getElementsByTagName("artikel")[a].childNodes[3].textContent.toLowerCase()===n||t.getElementsByTagName("artikel")[a].childNodes[4].textContent.toLowerCase().includes(n)||t.getElementsByTagName("artikel")[a].childNodes[10].textContent.toLowerCase()===n)&&r.push(t.getElementsByTagName("artikel")[a]);buildSearchResultTable(r,r.length,n)}function loadAllArtikels(){$.ajax({url:"https://cors-anywhere.herokuapp.com/https://www.systembolaget.se/api/assortment/products/xml",success:function(e){getAllInventory(e)},datatype:"xml",error:function(){alert("Error: Something went wrong")}})}function getAllInventory(e){for(var t=[],n=e.getElementsByTagName("artikel").length,r=0;r<n;r++)t.push(e.getElementsByTagName("artikel")[r])}function getDrink(e){var t="http://www.thecocktaildb.com/api/json/v1/1/lookup.php"+e;return $.ajax({url:t,async:!1,success:function(e){},error:function(e,t,n){alert("något gick fel med API-anslutningen")}}).responseJSON}function renderData(e){var t=e.drinks[0];$("title").append(t.strDrink),$("#category").append(t.strCategory),$("#alcoholic").append(t.strAlcoholic),$("#name").append(t.strDrink),$("#desc").append(t.strInstructions),$("#thumb").append("<img id='pic' src='"+t.strDrinkThumb+"'>");for(var n=fixIngredients(e),r=0;r<n.length;r++){var o="<li>"+n[r]+"</li>";$("#ingredients").append(o)}}function fixIngredients(e){for(var t=JSON.stringify(e),n=[],r=1;r<15;r++){var o=t.substring(t.indexOf("strMeasure"+r),t.indexOf("strMeasure"+(r+1)));o=o.substring(o.indexOf(":")+2,o.lastIndexOf(",")-1);var a=t.substring(t.indexOf("strIngredient"+r),t.indexOf("strIngredient"+(r+1))),i=o+(a=a.substring(a.indexOf(":")+2,a.lastIndexOf(",")-1));if(" "===i)break;n.push(i)}return n}function replaceAll(e,t,n){return e.replace(new RegExp(t,"g"),n)}initMap();var geocoder=new google.maps.Geocoder,map;$(document).ready(function(){loadStoreAddress(),document.getElementById("searchDrinkBtn").addEventListener("click",function(){loadStoreInventoryData(document.getElementById("searchDrinkInput").value.toLowerCase(),getStoreID())})}),$(document).ready(function(){$map=$("#map").hide(),$("#searchButton").click(function(){$map.slideDown(function(){loadStoreSearchData(document.getElementById("citySearchInput").value),initMap()})}),$("#useMyLocation").click(function(){$map.slideDown(function(){getMyLocation(map,geocoder),initMap()})}),$("#ageConfirmation").dialog({dialogClass:"no-close",resizable:!1,draggable:!1,height:"auto",width:"auto",modal:!0,buttons:{"Jag är 20 år gammal eller äldre":function(){$(this).dialog("close")},"Jag är under 20 år gammal":function(){window.location.href="under20.html"}}})}),$(document).ready(function(){}),$(document).ready(function(){var e=window.location.href;renderData(getDrink(e.substring(e.indexOf("?"),e.length)))});